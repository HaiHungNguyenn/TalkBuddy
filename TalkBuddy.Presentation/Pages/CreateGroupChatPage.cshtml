@page
@using TalkBuddy.Presentation.Components;
@model TalkBuddy.Presentation.Pages.CreateGroupChatPageModel
@{
}
<link rel="stylesheet" href="~/css/header.css" />

<style>

    .group-con {
        padding: 20px 50px;
    }

    .form-group {
        margin-bottom: 20px;
    }


    .input-group {
        margin-bottom: 15px;
    }

    #search-friend {
        width: calc(100% - 200px);
        border: 1px solid #ced4da;
        border-radius: 5px;
        font-size: 16px;
        margin: 10px 0;
    }



    .friend-list {
        max-height: 280px;
        overflow-y: auto;
        padding: 10px;
        border: 1px solid #ced4da;
        border-radius: 5px;
        background-color: #fff;
    }


    .chosenList {
        max-height: 280px;
        overflow-y: auto;
        padding: 10px;
        border: 1px solid #ced4da;
        border-radius: 5px;
        background-color: #fff;
    }

    .list-item {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }

        .list-item label {
            margin-left: 10px;
            font-size: 16px;
        }

    .checkbox {
        margin-right: 10px;
    }

</style>
<section class="h-100 w-100 d-flex flex-column justify-content-start" style="background-color: #e4e7f5;">
    <component type="typeof(Header)" render-mode="Static" />
    <div class="d-flex justify-content-center align-items-start h-100" style="background-color: #e4e7f5;">
        <div class="container group-con">
            <h4 class="text-center">Create group chat:</h4>

            <div class="form-group">
                <div class="row">
                    <label for="groupName">Group name:</label>
                    <input type="text" class="form-control" id="groupName" name="groupName">
                </div>
                <form method="get">
                    <div class="row">
                        <input name="search" class="form-control col-11" type="text" placeholder="type name to search" id="search-friend" />

                        <button type="submit" class="btn btn-primary col-1 mt-3 align-content-center align-items-center" style="margin: 15px 30px;">Search</button>

                    </div>
                </form>
                
                <form method="post">
                    <div class="row">
                        <div class="col-6">
                            <div class="friend-list" style="height: calc(100vh - 200px);">
                                <h7 class="text-center">Friends:</h7>
                                <div class="friend-scroll">
                                    @foreach (var friend in Model.FriendsList)
                                    {
                                        <div class="list-item">
                                            <input type="checkbox" id="friend-@friend.Id" class="checkbox" name="selectedFriends" value="@friend.Id" onchange="updateChosenList(this)">
                                            <label for="friend-@friend.Id">@friend.Name</label>
                                        </div>
                                    }
                                </div>
                    
                            </div>
                        </div>

                        <div class="col-6 chosenList" style="height: calc(100vh - 200px);">
                            <h7 class="text-center">Chosen:</h7>
                            <div class="chosen-scroll">
                                <!-- This div will be populated with selected friends -->
                             
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary mt-3 float-end" id="createGroupChatBtn" disabled>Create group chat</button>
                </form>
              
            </div>


        </div>
    </div>
</section>

<script>
    function updateChosenList(checkbox) {
        var friendId = checkbox.value;
        var friendName = checkbox.parentElement.querySelector('label').textContent;
        var chosenList = document.querySelector('.chosenList');
        console.log("updatelist: " + chosenList);
        if (checkbox.checked) {
            // Add the selected friend to the chosen list
            chosenList.innerHTML += `<div id="chosen-${friendId}">${friendName}</div>`;
            console.log("check: " + friendName);
        } else {
            // Remove the unselected friend from the chosen list
            var friendToRemove = chosenList.querySelector(`#chosen-${friendId}`);
            if (friendToRemove) {
                friendToRemove.remove();
            }
            console.log("uncheck: " + friendName);
        }

        // Enable or disable the Create group chat button based on the number of selected friends
        var selectedFriendsCount = document.querySelectorAll('input[name="selectedFriends"]:checked').length;
  
        var createGroupChatBtn = document.getElementById('createGroupChatBtn');
        if (selectedFriendsCount >= 2) {
            createGroupChatBtn.disabled = false;
        } else {
            createGroupChatBtn.disabled = true;
        }
    }
</script>

